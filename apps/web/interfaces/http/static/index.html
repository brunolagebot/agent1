<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent1 - Chat Interativo + RAG</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container { 
      max-width: 1000px; 
      margin: 0 auto; 
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      animation: fadeIn 0.8s ease-in;
    }
    
    .header h1 { 
      font-size: 2.5em; 
      margin-bottom: 10px;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .header p { 
      font-size: 1.1em; 
      opacity: 0.95;
    }
    
    .mode { 
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .mode label { 
      background: rgba(255,255,255,0.2);
      padding: 12px 24px;
      border-radius: 25px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.3);
    }
    
    .mode label:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .mode input[type="radio"] {
      margin-right: 8px;
    }
    
    .mode input[type="radio"]:checked + span {
      font-weight: 600;
    }
    
    .upload-section, .chat-section { 
      background: white; 
      padding: 25px; 
      border-radius: 16px; 
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      animation: slideUp 0.6s ease-out;
    }
    
    h3 { 
      color: #2d3748; 
      margin-bottom: 15px;
      font-size: 1.3em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .subtitle {
      font-size: 0.9em; 
      color: #718096; 
      margin: -8px 0 15px 0;
    }
    
    #messages { 
      height: 450px; 
      overflow-y: auto; 
      border: 2px solid #e2e8f0; 
      padding: 20px; 
      margin-bottom: 20px; 
      border-radius: 12px;
      background: #f7fafc;
    }
    
    #messages::-webkit-scrollbar {
      width: 8px;
    }
    
    #messages::-webkit-scrollbar-track {
      background: #e2e8f0;
      border-radius: 10px;
    }
    
    #messages::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 10px;
    }
    
    #messages::-webkit-scrollbar-thumb:hover {
      background: #a0aec0;
    }
    
    .message { 
      margin-bottom: 16px; 
      padding: 12px 18px; 
      border-radius: 18px;
      max-width: 80%;
      word-wrap: break-word;
      animation: messageSlide 0.3s ease-out;
    }
    
    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .user { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; 
      margin-left: auto;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .assistant { 
      background: white;
      color: #2d3748;
      border: 2px solid #e2e8f0;
      margin-right: auto;
    }
    
    .input-group { 
      display: flex; 
      gap: 12px;
      align-items: center;
    }
    
    input[type="text"] { 
      flex: 1; 
      padding: 14px 18px; 
      border: 2px solid #e2e8f0; 
      border-radius: 12px;
      font-size: 15px;
      transition: all 0.3s ease;
    }
    
    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    input[type="file"] {
      padding: 10px;
      border: 2px dashed #cbd5e0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    input[type="file"]:hover {
      border-color: #667eea;
      background: #f7fafc;
    }
    
    button { 
      padding: 14px 28px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; 
      border: none; 
      border-radius: 12px; 
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    button:hover { 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .status { 
      margin-top: 12px; 
      padding: 12px 16px; 
      border-radius: 10px; 
      font-size: 14px;
      animation: fadeIn 0.3s ease-in;
    }
    
    .status.success { 
      background: #c6f6d5; 
      color: #22543d;
      border-left: 4px solid #38a169;
    }
    
    .status.error { 
      background: #fed7d7; 
      color: #742a2a;
      border-left: 4px solid #e53e3e;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ü§ñ Agent1</h1>
      <p>Chat Inteligente com RAG ‚Ä¢ Qwen2.5 ‚Ä¢ Treinamento Autom√°tico</p>
    </div>

    <div class="mode">
      <label>
        <input type="radio" name="userRole" value="user" checked>
        <span>üë§ Usu√°rio</span>
      </label>
      <label>
        <input type="radio" name="userRole" value="admin">
        <span>üëë Admin</span>
      </label>
    </div>

    <div class="upload-section">
      <h3>üìÑ Biblioteca de Conhecimento</h3>
      <p class="subtitle">Envie PDFs ou arquivos de texto para o agente aprender automaticamente</p>
      <div class="input-group">
        <input type="file" id="fileInput" accept=".pdf,.txt,.md">
        <button onclick="uploadDocument()">üì§ Enviar Documento</button>
      </div>
      <div id="uploadStatus"></div>
    </div>

    <div class="chat-section">
      <h3>üí¨ Conversa</h3>
      <div id="messages"></div>
      <div class="input-group">
        <input type="text" id="messageInput" placeholder="Digite sua mensagem ou pergunte sobre seus documentos..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">Enviar ‚úàÔ∏è</button>
      </div>
    </div>
  </div>

  <script>
    let conversationId = null;

    function getUserRole() {
      return document.querySelector('input[name="userRole"]:checked').value;
    }

    function addMessage(role, content) {
      const messagesDiv = document.getElementById('messages');
      const msgDiv = document.createElement('div');
      msgDiv.className = 'message ' + role;
      msgDiv.textContent = content;
      messagesDiv.appendChild(msgDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      if (!message) return;

      const userRole = getUserRole();
      addMessage('user', message);
      input.value = '';

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ conversationId, message, userRole }),
        });

        const data = await res.json();
        if (data.error) throw new Error(data.error);

        conversationId = data.conversationId;
        addMessage('assistant', data.assistantMessage);
      } catch (error) {
        addMessage('assistant', `Erro: ${error.message}`);
      }
    }

    async function uploadDocument() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      if (!file) {
        showUploadStatus('Selecione um arquivo', 'error');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);
      formData.append('userRole', getUserRole());

      showUploadStatus('Processando...', 'success');

      try {
        const res = await fetch('/api/documents/upload', {
          method: 'POST',
          body: formData,
        });

        const data = await res.json();
        if (data.error) throw new Error(data.error);

        showUploadStatus(`‚úÖ ${data.filename} processado (${data.chunksCount} chunks)`, 'success');
        fileInput.value = '';
      } catch (error) {
        showUploadStatus(`Erro: ${error.message}`, 'error');
      }
    }

    function showUploadStatus(msg, type) {
      const status = document.getElementById('uploadStatus');
      status.textContent = msg;
      status.className = 'status ' + type;
      setTimeout(() => { status.textContent = ''; status.className = ''; }, 5000);
    }
  </script>
</body>
</html>

