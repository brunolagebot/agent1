<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent1 v0.5.2</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: system-ui; 
      background: #0f1419;
      color: #e3e8ec;
      padding: 20px;
    }
    .header { text-align: center; padding: 20px; background: #1a2332; border-radius: 8px; margin-bottom: 20px; }
    .container { max-width: 1200px; margin: 0 auto; display: flex; gap: 20px; }
    .sidebar { width: 260px; background: #1a2332; padding: 20px; border-radius: 8px; }
    .main { flex: 1; background: #1a2332; padding: 20px; border-radius: 8px; }
    button { padding: 10px 20px; background: #2d6a7a; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #3d8a9a; }
    input, textarea { width: 100%; padding: 10px; background: #0f1419; color: white; border: 1px solid #2d6a7a; border-radius: 6px; }
    #messages { height: 400px; overflow-y: auto; margin: 20px 0; padding: 10px; background: #0f1419; border-radius: 6px; }
    #telemetry { 
      background: rgba(26, 35, 50, 0.8); 
      border: 1px solid #2d6a7a; 
      border-radius: 6px; 
      padding: 12px; 
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      display: none;
    }
    #telemetry.active { display: block; }
    .telem-stage { 
      padding: 4px 0; 
      display: flex; 
      justify-content: space-between;
      color: #7a9ca8;
    }
    .telem-stage.done { color: #5db88f; }
    .telem-stage.current { color: #3d8a9a; font-weight: bold; }
    .telem-time { color: #a8c5d1; }
    .msg { padding: 10px; margin: 5px 0; border-radius: 6px; }
    .user { background: #2d6a7a; text-align: right; }
    .assistant { background: #1a4d5e; }
    .conv-item { padding: 10px; margin: 5px 0; background: #0f1419; border-radius: 6px; cursor: pointer; }
    .conv-item:hover { background: #2d6a7a; }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ¤– Agent1 v0.5.2</h1>
    <p>Modo Treinamento â€¢ Qwen2.5:14b</p>
  </div>

  <div class="container">
    <div class="sidebar">
      <button onclick="newChat()" style="width: 100%; margin-bottom: 20px;">â• Nova Conversa</button>
      
      <!-- Tabs -->
      <div style="display: flex; margin-bottom: 20px; border-radius: 6px; overflow: hidden;">
        <button id="chatTab" onclick="showTab('chat')" style="flex: 1; margin: 0; border-radius: 0; background: #2d6a7a;">ğŸ’¬ Chat</button>
        <button id="adminTab" onclick="showTab('admin')" style="flex: 1; margin: 0; border-radius: 0; background: #1a4d5e;">âš™ï¸ Admin</button>
      </div>
      
      <div id="chatSidebar">
        <h3 style="margin-bottom: 10px;">HistÃ³rico</h3>
        <div id="convList"></div>
      </div>
      
      <div id="adminSidebar" style="display: none;">
        <h3 style="margin-bottom: 15px;">ğŸ“Š AdministraÃ§Ã£o</h3>
        
        <!-- Fine-tuning Monitor -->
        <div style="background: #0f1419; padding: 15px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #2d6a7a;">
          <h4 style="color: #a8c5d1; margin-bottom: 10px;">ğŸ¯ Fine-tuning</h4>
          <div id="finetuningStatus" style="font-size: 12px; color: #7a9ca8;">
            <div>ğŸ“ Conversas: <span id="convCount">-</span></div>
            <div>ğŸ’¬ Mensagens: <span id="msgCount">-</span></div>
            <div>â­ Feedback: <span id="feedbackCount">-</span></div>
            <div id="docInfo" style="color: #7a9ca8;">ğŸ“„ Nenhum documento processado</div>
            <div style="margin-top: 8px; padding: 8px; border-radius: 4px; background: #1a2332;">
              <strong id="finetuningReady" style="color: #ffa500;">â³ Analisando...</strong>
            </div>
          </div>
        </div>
        
        <!-- Admin Buttons -->
        <button onclick="showStats()" style="width: 100%; margin-bottom: 10px;">ğŸ“Š Ver EstatÃ­sticas</button>
        <button onclick="analyzePerformance()" style="width: 100%; margin-bottom: 10px;">ğŸ” AnÃ¡lise de Performance</button>
        <button onclick="exportTraining()" style="width: 100%; margin-bottom: 10px;">ğŸ“¥ Exportar para Treino</button>
        <button onclick="listModels()" style="width: 100%; margin-bottom: 10px;">ğŸ¤– Listar Modelos</button>
        <button onclick="uploadDocument()" style="width: 100%; margin-bottom: 10px;">ğŸ“„ Upload Documento</button>
        <button onclick="manageDocuments()" style="width: 100%; margin-bottom: 10px;">ğŸ“š Gerenciar Documentos</button>
        <button onclick="showVersion()" style="width: 100%; margin-bottom: 15px;">ğŸ“– Ver VersÃ£o</button>
        
        <!-- Fine-tuning Section (Destacado) -->
        <div style="border-top: 2px solid #2d6a7a; padding-top: 15px; margin-top: 10px;">
          <div style="text-align: center; margin-bottom: 10px;">
            <h4 style="color: #a8c5d1; margin: 0; font-size: 16px;">ğŸš€ Fine-tuning do Modelo</h4>
            <div style="color: #7a9ca8; font-size: 12px; margin-top: 5px;">Treine o modelo com seus dados</div>
          </div>
          
          <!-- Barra de Progresso (inicialmente oculta) -->
          <div id="finetuningProgress" style="display: none; margin-bottom: 10px;">
            <div style="background: #1a2332; padding: 10px; border-radius: 4px; border: 1px solid #2d6a7a;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span id="progressText" style="color: #a8c5d1; font-size: 12px;">Iniciando...</span>
                <span id="progressPercent" style="color: #5db88f; font-size: 12px; font-weight: bold;">0%</span>
              </div>
              <div style="background: #0f1419; height: 8px; border-radius: 4px; overflow: hidden;">
                <div id="progressBar" style="background: linear-gradient(90deg, #2d6a7a, #5db88f); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
              </div>
              <div id="progressDetails" style="color: #7a9ca8; font-size: 11px; margin-top: 5px;"></div>
            </div>
          </div>
          
          <!-- Monitor de Desempenho -->
          <div id="performanceMonitor" style="display: none; background: #1a4d2a; padding: 10px; border-radius: 4px; margin-bottom: 10px; border: 1px solid #5db88f;">
            <div style="color: #5db88f; font-size: 12px; font-weight: bold; margin-bottom: 5px;">ğŸ“Š Monitor de Desempenho</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 11px;">
              <div style="color: #7a9ca8;">CPU: <span id="cpuUsage" style="color: #5db88f;">--</span></div>
              <div style="color: #7a9ca8;">MemÃ³ria: <span id="memoryUsage" style="color: #5db88f;">--</span></div>
              <div style="color: #7a9ca8;">Tempo: <span id="elapsedTime" style="color: #5db88f;">00:00</span></div>
              <div style="color: #7a9ca8;">Status: <span id="systemStatus" style="color: #5db88f;">Normal</span></div>
            </div>
          </div>
          
          <!-- BotÃ£o de Fine-tuning (Destacado) -->
          <button onclick="startFineTuning()" id="finetuningBtn" style="
            width: 100%; 
            padding: 15px; 
            margin-bottom: 10px; 
            background: #4d1a1a; 
            color: #ff6b6b; 
            border: 2px solid #ff6b6b; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
          ">ğŸš« Fine-tuning IndisponÃ­vel</button>
          
          <!-- InformaÃ§Ãµes do Fine-tuning -->
          <div id="finetuningInfo" style="background: #1a2332; padding: 10px; border-radius: 4px; border: 1px solid #2d6a7a;">
            <div style="color: #7a9ca8; font-size: 11px; text-align: center;">
              ğŸ’¡ <strong>Dica:</strong> O fine-tuning usa seus documentos e conversas para personalizar o modelo
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main">
      <div id="chatMain">
        <h3>ğŸ’¬ Chat - Modo Treinamento</h3>
      <div id="telemetry">
        <div style="color: #a8c5d1; font-weight: bold; margin-bottom: 8px;">â±ï¸ Telemetria em Tempo Real</div>
        <div id="telemStages"></div>
      </div>
        <div id="messages"></div>
        <div id="status" style="margin: 10px 0; color: #7a9ca8; font-size: 13px;"></div>
        <textarea id="input" placeholder="Digite sua mensagem..." rows="3"></textarea>
        <button onclick="send()" style="margin-top: 10px; width: 100%;">Enviar</button>
      </div>
      
      <div id="adminMain" style="display: none;">
        <h3>âš™ï¸ Painel de AdministraÃ§Ã£o</h3>
        <div id="adminContent" style="margin-top: 20px;">
          <p style="color: #7a9ca8;">Selecione uma opÃ§Ã£o na sidebar para comeÃ§ar.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let convId = null;
    let convs = [];
    let currentTab = 'chat';
    
    const stageLabels = {
      'create_conversation': '1. Criar/carregar conversa',
      'save_user_message': '2. Salvar mensagem usuÃ¡rio',
      'load_history': '3. Carregar histÃ³rico',
      'search_documents': '4. Buscar em documentos',
      'search_knowledge_base': '5. Consultar Knowledge Base',
      'prepare_context': '6. Preparar contexto',
      'llm_generation': '7. Gerar resposta (LLM)',
      'save_assistant_message': '8. Salvar resposta',
    };

    function showTelemetry() {
      const box = document.getElementById('telemetry');
      const stages = document.getElementById('telemStages');
      box.classList.add('active');
      
      stages.innerHTML = Object.entries(stageLabels).map(([key, label]) =>
        '<div class="telem-stage" id="stage-' + key + '">' +
          '<span>' + label + '</span>' +
          '<span class="telem-time">â³</span>' +
        '</div>'
      ).join('');
    }

    function hideTelemetry() {
      document.getElementById('telemetry').classList.remove('active');
    }

    function updateStage(stage, status, duration) {
      const el = document.getElementById('stage-' + stage);
      if (!el) return;
      
      if (status === 'current') {
        el.className = 'telem-stage current';
        el.querySelector('.telem-time').textContent = 'â³ processando...';
      } else if (status === 'done') {
        el.className = 'telem-stage done';
        el.querySelector('.telem-time').textContent = 'âœ“ ' + duration + 'ms';
      }
    }

    async function loadConvs() {
      try {
        const r = await fetch('/api/conversations');
        const d = await r.json();
        convs = d.conversations || [];
        renderConvs();
      } catch (e) {
        console.error(e);
      }
    }

    function renderConvs() {
      const list = document.getElementById('convList');
      if (convs.length === 0) {
        list.innerHTML = '<p style="color: #7a9ca8;">Nenhuma conversa</p>';
        return;
      }
      
      list.innerHTML = '';
      convs.slice(0, 20).forEach(c => {
        const div = document.createElement('div');
        div.className = 'conv-item';
        div.textContent = (c.title || 'Conversa').substring(0, 30);
        div.onclick = () => loadConv(c.id);
        list.appendChild(div);
      });
    }

    async function loadConv(id) {
      try {
        convId = id;
        const r = await fetch('/api/conversations/' + id + '/messages');
        const d = await r.json();
        
        document.getElementById('messages').innerHTML = '';
        d.messages.forEach(m => addMsg(m.role, m.content));
      } catch (e) {
        console.error(e);
      }
    }

    function newChat() {
      convId = null;
      document.getElementById('messages').innerHTML = '';
      document.getElementById('input').value = '';
    }

    function addMsg(role, text, messageId = null, sources = null) {
      const div = document.createElement('div');
      div.className = 'msg ' + role;
      div.textContent = text;
      
      // Adicionar informaÃ§Ãµes de fonte para mensagens do assistente
      if (role === 'assistant' && sources && (sources.documents.length > 0 || sources.knowledgeBase.length > 0)) {
        const sourcesDiv = document.createElement('div');
        sourcesDiv.className = 'sources-container';
        sourcesDiv.style.cssText = 'margin-top: 10px; padding: 8px; background: #1a2332; border-radius: 4px; border: 1px solid #2d6a7a;';
        
        let sourcesHtml = '<div style="font-size: 11px; color: #5db88f; font-weight: bold; margin-bottom: 5px;">ğŸ“š Fontes consultadas:</div>';
        
        if (sources.documents.length > 0) {
          sourcesHtml += '<div style="font-size: 10px; color: #7a9ca8; margin-bottom: 3px;">ğŸ“„ Documentos:</div>';
          sources.documents.forEach((doc, i) => {
            const similarity = Math.round(doc.similarity * 100);
            sourcesHtml += `<div style="font-size: 10px; color: #a8c5d1; margin-left: 10px; margin-bottom: 2px;">
              â€¢ ${doc.filename}${doc.description ? ` (${doc.description})` : ''} - ${similarity}% relevÃ¢ncia
            </div>`;
          });
        }
        
        if (sources.knowledgeBase.length > 0) {
          sourcesHtml += '<div style="font-size: 10px; color: #7a9ca8; margin-bottom: 3px;">ğŸ§  Base de Conhecimento:</div>';
          sources.knowledgeBase.forEach((fact, i) => {
            sourcesHtml += `<div style="font-size: 10px; color: #a8c5d1; margin-left: 10px; margin-bottom: 2px;">
              â€¢ ${fact.title}
            </div>`;
          });
        }
        
        sourcesDiv.innerHTML = sourcesHtml;
        div.appendChild(sourcesDiv);
      }
      
      // Adicionar feedback para mensagens do assistente
      if (role === 'assistant' && messageId) {
        const feedbackDiv = document.createElement('div');
        feedbackDiv.className = 'feedback-container';
        feedbackDiv.style.cssText = 'margin-top: 10px; text-align: center;';
        feedbackDiv.innerHTML = `
          <div style="font-size: 12px; color: #7a9ca8; margin-bottom: 5px;">Avalie esta resposta:</div>
          <div class="feedback-buttons" style="display: flex; gap: 5px; justify-content: center;">
            <button onclick="submitFeedback('${messageId}', 1)" style="padding: 5px 10px; font-size: 16px; background: transparent; border: 1px solid #2d6a7a; border-radius: 4px; cursor: pointer;">ğŸ˜</button>
            <button onclick="submitFeedback('${messageId}', 2)" style="padding: 5px 10px; font-size: 16px; background: transparent; border: 1px solid #2d6a7a; border-radius: 4px; cursor: pointer;">ğŸ˜•</button>
            <button onclick="submitFeedback('${messageId}', 3)" style="padding: 5px 10px; font-size: 16px; background: transparent; border: 1px solid #2d6a7a; border-radius: 4px; cursor: pointer;">ğŸ˜</button>
            <button onclick="submitFeedback('${messageId}', 4)" style="padding: 5px 10px; font-size: 16px; background: transparent; border: 1px solid #2d6a7a; border-radius: 4px; cursor: pointer;">ğŸ™‚</button>
            <button onclick="submitFeedback('${messageId}', 5)" style="padding: 5px 10px; font-size: 16px; background: transparent; border: 1px solid #2d6a7a; border-radius: 4px; cursor: pointer;">ğŸ˜</button>
          </div>
        `;
        div.appendChild(feedbackDiv);
      }
      
      document.getElementById('messages').appendChild(div);
      document.getElementById('messages').scrollTop = 999999;
    }

    async function send() {
      const input = document.getElementById('input');
      const msg = input.value.trim();
      if (!msg) return;

      addMsg('user', msg);
      input.value = '';
      
      // Mostrar telemetria
      showTelemetry();
      document.getElementById('status').textContent = 'ğŸš€ Iniciando processamento...';

      // Simular progresso das etapas (estimativa visual)
      const stages = Object.keys(stageLabels);
      let currentIdx = 0;
      
      const progressInterval = setInterval(() => {
        if (currentIdx < stages.length) {
          updateStage(stages[currentIdx], 'current', 0);
          if (currentIdx > 0) {
            updateStage(stages[currentIdx - 1], 'done', '~');
          }
          
          // Atualizar status
          document.getElementById('status').textContent = stageLabels[stages[currentIdx]];
          currentIdx++;
        }
      }, 3000); // A cada 3s muda de etapa (estimativa)

      try {
        const start = Date.now();
        
        const r = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({conversationId: convId, message: msg})
        });

        clearInterval(progressInterval);
        const totalTime = Date.now() - start;

        const d = await r.json();
        if (d.error) throw new Error(d.error);

        convId = d.conversationId;
        addMsg('assistant', d.assistantMessage, d.messageId, d.sources);
        
        // Atualizar telemetria com dados reais
        if (d.telemetry && d.telemetry.stages) {
          Object.entries(d.telemetry.stages).forEach(([stageName, data]) => {
            updateStage(stageName, 'done', data.duration);
          });
        } else {
          // Marcar todas como concluÃ­das
          stages.forEach(s => updateStage(s, 'done', '?'));
        }
        
        document.getElementById('status').textContent = 'âœ… Pronto! (' + (totalTime / 1000).toFixed(1) + 's total)';
        loadConvs();
        
        setTimeout(() => {
          document.getElementById('status').textContent = '';
          hideTelemetry();
        }, 5000);
      } catch (e) {
        clearInterval(progressInterval);
        hideTelemetry();
        document.getElementById('status').textContent = 'âŒ Erro: ' + e.message;
        console.error(e);
      }
    }

    // Enter para enviar
    document.getElementById('input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });

    // Feedback System
    async function submitFeedback(messageId, rating) {
      try {
        const response = await fetch('/api/messages/feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messageId, rating })
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Encontrar o botÃ£o clicado e destacar
          const buttons = document.querySelectorAll(`button[onclick="submitFeedback('${messageId}', ${rating})"]`);
          buttons.forEach(btn => {
            btn.style.background = '#5db88f';
            btn.style.borderColor = '#5db88f';
            btn.disabled = true;
          });
          
          // Desabilitar todos os botÃµes de feedback desta mensagem
          const allButtons = document.querySelectorAll(`button[onclick*="submitFeedback('${messageId}'"]`);
          allButtons.forEach(btn => {
            if (!btn.disabled) {
              btn.style.opacity = '0.5';
              btn.disabled = true;
            }
          });
          
          // Atualizar status de fine-tuning se estivermos na aba admin
          if (currentTab === 'admin') {
            updateFineTuningStatus();
          }
        }
      } catch (error) {
        console.error('Erro ao enviar feedback:', error);
      }
    }

    // FunÃ§Ãµes auxiliares para Fine-tuning
    function updateProgress(percent, text, details) {
      document.getElementById('progressPercent').textContent = `${percent}%`;
      document.getElementById('progressText').textContent = text;
      document.getElementById('progressDetails').textContent = details;
      document.getElementById('progressBar').style.width = `${percent}%`;
    }

    function updatePerformanceMonitor(startTime) {
      const elapsed = Date.now() - startTime;
      const minutes = Math.floor(elapsed / 60000);
      const seconds = Math.floor((elapsed % 60000) / 1000);
      document.getElementById('elapsedTime').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Simular mÃ©tricas de sistema (em produÃ§Ã£o, viriam de uma API real)
      const cpuUsage = Math.floor(Math.random() * 30) + 20; // 20-50%
      const memoryUsage = Math.floor(Math.random() * 20) + 60; // 60-80%
      
      document.getElementById('cpuUsage').textContent = `${cpuUsage}%`;
      document.getElementById('memoryUsage').textContent = `${memoryUsage}%`;
      
      // Status baseado nas mÃ©tricas
      let status = 'Normal';
      let statusColor = '#5db88f';
      
      if (cpuUsage > 80 || memoryUsage > 90) {
        status = 'Alto';
        statusColor = '#ffa500';
      } else if (cpuUsage > 60 || memoryUsage > 80) {
        status = 'MÃ©dio';
        statusColor = '#ffa500';
      }
      
      document.getElementById('systemStatus').textContent = status;
      document.getElementById('systemStatus').style.color = statusColor;
    }

    // Tab Management
    function showTab(tab) {
      currentTab = tab;
      
      // Update tab buttons
      document.getElementById('chatTab').style.background = tab === 'chat' ? '#2d6a7a' : '#1a4d5e';
      document.getElementById('adminTab').style.background = tab === 'admin' ? '#2d6a7a' : '#1a4d5e';
      
      // Show/hide sidebar sections
      document.getElementById('chatSidebar').style.display = tab === 'chat' ? 'block' : 'none';
      document.getElementById('adminSidebar').style.display = tab === 'admin' ? 'block' : 'none';
      
      // Show/hide main sections
      document.getElementById('chatMain').style.display = tab === 'chat' ? 'block' : 'none';
      document.getElementById('adminMain').style.display = tab === 'admin' ? 'block' : 'none';
      
      if (tab === 'admin') {
        updateFineTuningStatus();
      }
    }

    // Fine-tuning Status Monitor
    async function updateFineTuningStatus() {
      try {
        const response = await fetch('/api/admin/finetuning-status');
        const data = await response.json();
        
        document.getElementById('convCount').textContent = data.stats.conversations || 0;
        document.getElementById('msgCount').textContent = data.stats.messages || 0;
        document.getElementById('feedbackCount').textContent = data.stats.feedback?.count || 0;
        
        // Verificar se estÃ¡ pronto para fine-tuning
        const isReady = data.isReady;
        const hasConversationData = data.stats.dataSources?.hasConversationData || false;
        const hasDocumentData = data.stats.dataSources?.hasDocumentData || false;
        const processedDocs = data.stats.processedDocuments || 0;
        
        const readyElement = document.getElementById('finetuningReady');
        const finetuningBtn = document.getElementById('finetuningBtn');
        
        if (isReady) {
          let statusText = 'âœ… <span style="color: #5db88f;">Pronto para Fine-tuning!</span>';
          let buttonText = 'ğŸš€ Iniciar Fine-tuning';
          let buttonColor = '#1a4d2a';
          let textColor = '#5db88f';
          
          if (hasDocumentData && !hasConversationData) {
            statusText = 'ğŸ“š <span style="color: #7a9ca8;">Pronto com Documentos!</span>';
            buttonText = 'ğŸ“š Fine-tuning com Documentos';
            buttonColor = '#2d4a6a';
            textColor = '#7a9ca8';
          } else if (hasConversationData && hasDocumentData) {
            statusText = 'ğŸš€ <span style="color: #5db88f;">Pronto Completo!</span>';
            buttonText = 'ğŸš€ Fine-tuning Completo';
            buttonColor = '#1a4d2a';
            textColor = '#5db88f';
          }
          
          readyElement.innerHTML = statusText;
          readyElement.style.background = '#1a4d2a';
          
          finetuningBtn.innerHTML = buttonText;
          finetuningBtn.style.background = buttonColor;
          finetuningBtn.style.color = textColor;
          finetuningBtn.disabled = false;
        } else {
          readyElement.innerHTML = 'ğŸ”´ <span style="color: #ff6b6b;">Precisa de mais dados</span>';
          readyElement.style.background = '#4d1a1a';
          
          // BotÃ£o indisponÃ­vel
          const finetuningBtn = document.getElementById('finetuningBtn');
          finetuningBtn.innerHTML = 'ğŸš« Fine-tuning IndisponÃ­vel';
          finetuningBtn.style.background = '#4d1a1a';
          finetuningBtn.style.color = '#ff6b6b';
          finetuningBtn.disabled = true;
        }
        
        // Atualizar informaÃ§Ãµes sobre documentos
        const docInfo = document.getElementById('docInfo');
        if (docInfo) {
          if (processedDocs > 0) {
            docInfo.innerHTML = `ğŸ“„ ${processedDocs} documento(s) processado(s) - Dados disponÃ­veis para fine-tuning`;
            docInfo.style.color = '#5db88f';
          } else {
            docInfo.innerHTML = 'ğŸ“„ Nenhum documento processado';
            docInfo.style.color = '#7a9ca8';
          }
        }
        
      } catch (error) {
        console.error('Erro ao atualizar status:', error);
        document.getElementById('finetuningReady').innerHTML = 'âŒ Erro ao carregar';
      }
    }

    // Admin Functions
    async function showStats() {
      try {
        const response = await fetch('/api/system/stats');
        const stats = await response.json();
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #a8c5d1; margin-bottom: 15px;">ğŸ“Š EstatÃ­sticas do Sistema</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div style="background: #1a2332; padding: 15px; border-radius: 4px;">
                <h5 style="color: #7a9ca8;">ğŸ’¬ Conversas</h5>
                <div style="font-size: 24px; color: #a8c5d1; font-weight: bold;">${stats.conversations || 0}</div>
              </div>
              <div style="background: #1a2332; padding: 15px; border-radius: 4px;">
                <h5 style="color: #7a9ca8;">ğŸ“ Mensagens</h5>
                <div style="font-size: 24px; color: #a8c5d1; font-weight: bold;">${stats.messages || 0}</div>
              </div>
              <div style="background: #1a2332; padding: 15px; border-radius: 4px;">
                <h5 style="color: #7a9ca8;">ğŸ“„ Documentos</h5>
                <div style="font-size: 24px; color: #a8c5d1; font-weight: bold;">${stats.documents || 0}</div>
              </div>
              <div style="background: #1a2332; padding: 15px; border-radius: 4px;">
                <h5 style="color: #7a9ca8;">ğŸ§  Fatos</h5>
                <div style="font-size: 24px; color: #a8c5d1; font-weight: bold;">${stats.facts || 0}</div>
              </div>
            </div>
            <div style="margin-top: 20px; background: #1a2332; padding: 15px; border-radius: 4px;">
              <h5 style="color: #7a9ca8;">â­ Feedback</h5>
              <div>MÃ©dia: <strong style="color: #a8c5d1;">${stats.feedback?.average || '0.00'}/5.0</strong></div>
              <div>Total: <strong style="color: #a8c5d1;">${stats.feedback?.count || 0}</strong> avaliaÃ§Ãµes</div>
            </div>
            <div style="margin-top: 20px; background: #1a2332; padding: 15px; border-radius: 4px;">
              <h5 style="color: #7a9ca8;">âš¡ Performance</h5>
              ${stats.performance?.map(p => 
                `<div>${p.operation}: <strong style="color: #a8c5d1;">${(p.avg_ms / 1000).toFixed(2)}s</strong></div>`
              ).join('') || '<div>Nenhum dado disponÃ­vel</div>'}
            </div>
          </div>
        `;
      } catch (error) {
        document.getElementById('adminContent').innerHTML = `<p style="color: #ff6b6b;">Erro: ${error.message}</p>`;
      }
    }

    async function analyzePerformance() {
      try {
        const response = await fetch('/api/logs/analyze');
        const analysis = await response.json();
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #a8c5d1; margin-bottom: 15px;">ğŸ” AnÃ¡lise de Performance</h4>
            <pre style="background: #1a2332; padding: 15px; border-radius: 4px; overflow-x: auto; color: #e3e8ec; font-size: 12px;">${JSON.stringify(analysis, null, 2)}</pre>
          </div>
        `;
      } catch (error) {
        document.getElementById('adminContent').innerHTML = `<p style="color: #ff6b6b;">Erro: ${error.message}</p>`;
      }
    }

    async function exportTraining() {
      try {
        document.getElementById('adminContent').innerHTML = '<p style="color: #7a9ca8;">ğŸ“¥ Preparando exportaÃ§Ã£o...</p>';
        
        const response = await fetch('/api/admin/export');
        const blob = await response.blob();
        
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `training-data-${new Date().toISOString().split('T')[0]}.jsonl`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #5db88f; margin-bottom: 15px;">âœ… ExportaÃ§Ã£o ConcluÃ­da</h4>
            <p>Arquivo de treinamento baixado com sucesso!</p>
            <p style="color: #7a9ca8; font-size: 12px; margin-top: 10px;">
              Use este arquivo para fine-tuning do modelo com ferramentas como LoRA, QLoRA ou similar.
            </p>
          </div>
        `;
      } catch (error) {
        document.getElementById('adminContent').innerHTML = `<p style="color: #ff6b6b;">Erro: ${error.message}</p>`;
      }
    }

    async function listModels() {
      try {
        const response = await fetch('/api/admin/models');
        const models = await response.json();
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #a8c5d1; margin-bottom: 15px;">ğŸ¤– Modelos DisponÃ­veis</h4>
            <pre style="background: #1a2332; padding: 15px; border-radius: 4px; overflow-x: auto; color: #e3e8ec; font-size: 12px;">${JSON.stringify(models, null, 2)}</pre>
          </div>
        `;
      } catch (error) {
        document.getElementById('adminContent').innerHTML = `<p style="color: #ff6b6b;">Erro: ${error.message}</p>`;
      }
    }

    function uploadDocument() {
      document.getElementById('adminContent').innerHTML = `
        <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
          <h4 style="color: #a8c5d1; margin-bottom: 15px;">ğŸ“„ Upload de Documentos</h4>
          
          <div style="margin-bottom: 15px;">
            <label style="color: #a8c5d1; font-size: 14px; margin-bottom: 5px; display: block;">ğŸ“ Arquivos:</label>
            <input type="file" id="fileInput" accept=".pdf,.txt,.md,.csv,.xlsx,.xls" multiple style="width: 100%; padding: 10px; background: #1a2332; border: 1px solid #2d6a7a; border-radius: 4px; color: #e3e8ec;">
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="color: #a8c5d1; font-size: 14px; margin-bottom: 5px; display: block;">ğŸ“ DescriÃ§Ã£o (opcional):</label>
            <textarea id="descriptionInput" placeholder="Ex: Contrato de prestaÃ§Ã£o de serviÃ§os, Manual tÃ©cnico, etc." style="width: 100%; padding: 10px; background: #1a2332; border: 1px solid #2d6a7a; border-radius: 4px; color: #e3e8ec; resize: vertical; min-height: 60px; font-family: inherit;"></textarea>
          </div>
          
          <div style="color: #7a9ca8; font-size: 12px; margin-bottom: 15px;">
            ğŸ’¡ <strong>Dica:</strong> VocÃª pode selecionar mÃºltiplos arquivos (PDF/TXT/MD/CSV/Excel) de uma vez. MÃ¡ximo 10MB por arquivo.<br>
            ğŸ“Š <strong>Planilhas:</strong> CSV e Excel sÃ£o analisadas automaticamente para gerar QA estruturada.<br>
            ğŸ“ A descriÃ§Ã£o serÃ¡ aplicada a todos os arquivos selecionados.
          </div>
          
          <button onclick="doUpload()" style="width: 100%; padding: 10px; background: #2d6a7a; color: #e3e8ec; border: none; border-radius: 4px; cursor: pointer;">ğŸ“¤ Enviar Documentos</button>
          <div id="uploadStatus" style="margin-top: 15px;"></div>
        </div>
      `;
    }

    async function doUpload() {
      const fileInput = document.getElementById('fileInput');
      const descriptionInput = document.getElementById('descriptionInput');
      const files = fileInput.files;
      
      if (!files || files.length === 0) {
        document.getElementById('uploadStatus').innerHTML = '<p style="color: #ff6b6b;">Selecione pelo menos um arquivo!</p>';
        return;
      }
      
      const formData = new FormData();
      for (let i = 0; i < files.length; i++) {
        formData.append('file', files[i]);
      }
      
      // Adicionar descriÃ§Ã£o se fornecida
      const description = descriptionInput.value.trim();
      if (description) {
        formData.append('description', description);
      }
      
      try {
        document.getElementById('uploadStatus').innerHTML = `
          <div style="color: #ffa500;">
            â³ Processando ${files.length} arquivo(s)...<br>
            <div style="font-size: 12px; margin-top: 5px;">
              ${Array.from(files).map(f => `â€¢ ${f.name} (${(f.size / 1024).toFixed(1)} KB)`).join('<br>')}
            </div>
          </div>
        `;
        
        const response = await fetch('/api/documents/upload', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
          let successHtml = `
            <div style="color: #5db88f; margin-bottom: 15px;">
              âœ… Upload concluÃ­do!<br>
              ğŸ“Š ${result.processed}/${result.total} arquivo(s) processado(s) com sucesso
            </div>
          `;
          
          if (result.results && result.results.length > 0) {
            successHtml += `
              <div style="background: #1a4d2a; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                <div style="color: #5db88f; font-weight: bold; margin-bottom: 5px;">ğŸ“„ Documentos Processados:</div>
                ${result.results.map(doc => `
                  <div style="color: #7a9ca8; font-size: 12px; margin-bottom: 3px;">
                    â€¢ ${doc.filename} (${(doc.size / 1024).toFixed(1)} KB) - ${doc.chunksCount} chunks
                  </div>
                `).join('')}
              </div>
            `;
          }
          
          if (result.errors && result.errors.length > 0) {
            successHtml += `
              <div style="background: #4d1a1a; padding: 10px; border-radius: 4px;">
                <div style="color: #ff6b6b; font-weight: bold; margin-bottom: 5px;">âš ï¸ Erros:</div>
                ${result.errors.map(err => `
                  <div style="color: #ff6b6b; font-size: 12px; margin-bottom: 3px;">
                    â€¢ ${err.filename}: ${err.error}
                  </div>
                `).join('')}
              </div>
            `;
          }
          
          document.getElementById('uploadStatus').innerHTML = successHtml;
          fileInput.value = '';
          
          // Atualizar lista de documentos se estivermos na aba de gerenciamento
          setTimeout(() => {
            if (document.getElementById('adminContent').innerHTML.includes('Gerenciar Documentos')) {
              manageDocuments();
            }
          }, 1000);
          
        } else {
          let errorHtml = '<div style="color: #ff6b6b;">âŒ Erro no upload:</div>';
          if (result.errors && result.errors.length > 0) {
            errorHtml += result.errors.map(err => `
              <div style="color: #ff6b6b; font-size: 12px; margin: 5px 0;">
                â€¢ ${err.filename}: ${err.error}
              </div>
            `).join('');
          } else {
            errorHtml += `<div style="color: #ff6b6b; font-size: 12px;">${result.error || 'Erro desconhecido'}</div>`;
          }
          document.getElementById('uploadStatus').innerHTML = errorHtml;
        }
      } catch (error) {
        document.getElementById('uploadStatus').innerHTML = `
          <div style="color: #ff6b6b;">
            âŒ Erro de conexÃ£o: ${error.message}
          </div>
        `;
      }
    }

    async function showVersion() {
      try {
        const response = await fetch('/api/system/version');
        const version = await response.json();
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #a8c5d1; margin-bottom: 15px;">ğŸ“– InformaÃ§Ãµes da VersÃ£o</h4>
            <pre style="background: #1a2332; padding: 15px; border-radius: 4px; overflow-x: auto; color: #e3e8ec; font-size: 12px;">${JSON.stringify(version, null, 2)}</pre>
          </div>
        `;
      } catch (error) {
        document.getElementById('adminContent').innerHTML = `<p style="color: #ff6b6b;">Erro: ${error.message}</p>`;
      }
    }

    async function manageDocuments() {
      try {
        // Buscar lista de documentos
        const response = await fetch('/api/documents');
        const data = await response.json();
        
        // Buscar estatÃ­sticas
        const statsResponse = await fetch('/api/documents/stats');
        const stats = await statsResponse.json();
        
        const documents = data.documents || [];
        const documentStats = stats.stats || {};
        
        let documentsHtml = '';
        
        if (documents.length === 0) {
          documentsHtml = `
            <div style="background: #1a2332; padding: 20px; border-radius: 4px; text-align: center; color: #7a9ca8;">
              ğŸ“„ Nenhum documento encontrado
            </div>
          `;
        } else {
          documentsHtml = documents.map(doc => `
            <div style="background: #1a2332; padding: 15px; border-radius: 4px; margin-bottom: 10px; border: 1px solid #2d6a7a;">
              <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="flex: 1;">
                  <div style="color: #a8c5d1; font-weight: bold; margin-bottom: 5px;">${doc.filename}</div>
                  <div id="description-${doc.id}" style="margin-bottom: 5px;">
                    ${doc.description ? `<div style="color: #5db88f; font-size: 12px; font-style: italic;">ğŸ“ ${doc.description}</div>` : '<div style="color: #7a9ca8; font-size: 12px; font-style: italic;">ğŸ“ Sem descriÃ§Ã£o</div>'}
                  </div>
                  <div style="color: #7a9ca8; font-size: 12px;">
                    ğŸ“ ${doc.fileType} â€¢ ğŸ“ ${(doc.fileSize / 1024).toFixed(1)} KB â€¢ 
                    ${doc.processed ? 'âœ… Processado' : 'â³ Processando'} â€¢ 
                    ğŸ“… ${new Date(doc.createdAt).toLocaleDateString('pt-BR')}
                  </div>
                </div>
                <div style="display: flex; gap: 5px; margin-left: 10px;">
                  <button onclick="editDescription('${doc.id}', '${doc.filename}', '${(doc.description || '').replace(/'/g, "\\'")}')" 
                          style="background: #2d6a7a; color: #a8c5d1; border: 1px solid #2d6a7a; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                    âœï¸ Editar
                  </button>
                  <button onclick="deleteDocument('${doc.id}', '${doc.filename}')" 
                          style="background: #4d1a1a; color: #ff6b6b; border: 1px solid #ff6b6b; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                    ğŸ—‘ï¸ Remover
                  </button>
                </div>
              </div>
            </div>
          `).join('');
        }
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #a8c5d1; margin-bottom: 15px;">ğŸ“š Gerenciar Documentos</h4>
            
            <!-- EstatÃ­sticas -->
            <div style="background: #1a4d2a; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
              <div style="color: #5db88f; font-weight: bold; margin-bottom: 10px;">ğŸ“Š EstatÃ­sticas</div>
              <div style="color: #7a9ca8; font-size: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div>ğŸ“„ Total: ${documentStats.totalDocuments || 0}</div>
                <div>âœ… Processados: ${documentStats.processedDocuments || 0}</div>
                <div>ğŸ“ Tamanho: ${((documentStats.totalSize || 0) / 1024).toFixed(1)} KB</div>
                <div>ğŸ§© Chunks: ${documentStats.totalChunks || 0}</div>
              </div>
            </div>
            
            <!-- Lista de documentos -->
            <div style="margin-bottom: 15px;">
              <div style="color: #a8c5d1; font-weight: bold; margin-bottom: 10px;">ğŸ“‹ Documentos Carregados</div>
              ${documentsHtml}
            </div>
            
            <div style="color: #7a9ca8; font-size: 12px; margin-top: 15px;">
              ğŸ’¡ <strong>Dica:</strong> Remover documentos tambÃ©m remove todos os chunks e embeddings associados.
              O contexto serÃ¡ removido das respostas do assistente.
            </div>
          </div>
        `;
      } catch (error) {
        document.getElementById('adminContent').innerHTML = `<p style="color: #ff6b6b;">Erro: ${error.message}</p>`;
      }
    }

    async function editDescription(documentId, filename, currentDescription) {
      const newDescription = prompt(
        `Editar descriÃ§Ã£o do documento "${filename}":\n\n(Deixe em branco para remover a descriÃ§Ã£o)`,
        currentDescription || ''
      );
      
      if (newDescription === null) {
        return; // UsuÃ¡rio cancelou
      }
      
      try {
        const response = await fetch(`/api/documents/${documentId}/description`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            description: newDescription.trim() || null 
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Atualizar a descriÃ§Ã£o na interface sem recarregar tudo
          const descriptionElement = document.getElementById(`description-${documentId}`);
          if (descriptionElement) {
            const newDesc = result.document.description;
            descriptionElement.innerHTML = newDesc 
              ? `<div style="color: #5db88f; font-size: 12px; font-style: italic;">ğŸ“ ${newDesc}</div>`
              : '<div style="color: #7a9ca8; font-size: 12px; font-style: italic;">ğŸ“ Sem descriÃ§Ã£o</div>';
          }
          
          // Mostrar mensagem de sucesso
          const successDiv = document.createElement('div');
          successDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #1a4d2a; color: #5db88f; padding: 15px; border-radius: 4px; border: 1px solid #5db88f; z-index: 1000;';
          successDiv.textContent = `âœ… ${result.message}`;
          document.body.appendChild(successDiv);
          
          setTimeout(() => {
            document.body.removeChild(successDiv);
          }, 3000);
        } else {
          throw new Error(result.error || 'Erro ao atualizar descriÃ§Ã£o');
        }
      } catch (error) {
        console.error('Erro ao atualizar descriÃ§Ã£o:', error);
        alert(`Erro ao atualizar descriÃ§Ã£o: ${error.message}`);
      }
    }

    async function deleteDocument(documentId, filename) {
      if (!confirm(`Tem certeza que deseja remover o documento "${filename}"?\n\nIsso tambÃ©m removerÃ¡ todos os chunks e embeddings associados.`)) {
        return;
      }
      
      try {
        const response = await fetch(`/api/documents/${documentId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Recarregar lista de documentos
          manageDocuments();
          
          // Mostrar mensagem de sucesso
          const successDiv = document.createElement('div');
          successDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #1a4d2a; color: #5db88f; padding: 15px; border-radius: 4px; border: 1px solid #5db88f; z-index: 1000;';
          successDiv.textContent = `âœ… ${result.message}`;
          document.body.appendChild(successDiv);
          
          setTimeout(() => {
            document.body.removeChild(successDiv);
          }, 3000);
        } else {
          throw new Error(result.error || 'Erro ao remover documento');
        }
      } catch (error) {
        console.error('Erro ao remover documento:', error);
        alert(`Erro ao remover documento: ${error.message}`);
      }
    }

    async function startFineTuning() {
      const finetuningBtn = document.getElementById('finetuningBtn');
      const originalText = finetuningBtn.innerHTML;
      
      try {
        // Desabilitar botÃ£o e mostrar progresso
        finetuningBtn.disabled = true;
        finetuningBtn.innerHTML = 'â³ Iniciando Fine-tuning...';
        finetuningBtn.style.background = '#4d3a1a';
        finetuningBtn.style.color = '#ffa500';
        
        // Mostrar barra de progresso e monitor
        document.getElementById('finetuningProgress').style.display = 'block';
        document.getElementById('performanceMonitor').style.display = 'block';
        
        // Iniciar monitor de desempenho
        const startTime = Date.now();
        const performanceInterval = setInterval(() => {
          updatePerformanceMonitor(startTime);
        }, 1000);
        
        // Atualizar progresso
        updateProgress(0, 'Iniciando fine-tuning...', 'Preparando sistema');
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #a8c5d1; margin-bottom: 15px;">ğŸš€ Fine-tuning em Andamento</h4>
            <div style="background: #1a4d2a; padding: 15px; border-radius: 4px; margin-bottom: 15px; border: 1px solid #5db88f;">
              <div style="color: #5db88f; font-weight: bold; margin-bottom: 10px;">ğŸ“Š Status do Processo</div>
              <div style="color: #7a9ca8; font-size: 12px;">
                â€¢ Sistema iniciado e funcionando normalmente<br>
                â€¢ Monitor de desempenho ativo<br>
                â€¢ Barra de progresso atualizada em tempo real
              </div>
            </div>
            <p style="color: #7a9ca8; font-size: 12px;">
              O fine-tuning estÃ¡ sendo executado com monitoramento completo. Este processo pode levar alguns minutos.
              VocÃª pode acompanhar o progresso na barra acima e continuar usando o chat normalmente.
            </p>
          </div>
        `;
        
        // Simular etapas do fine-tuning com progresso
        const steps = [
          { progress: 10, text: 'Coletando dados de treinamento...', details: 'Analisando conversas e documentos' },
          { progress: 30, text: 'Gerando QA dos documentos...', details: 'Criando perguntas e respostas' },
          { progress: 50, text: 'Formatando dados...', details: 'Preparando para treinamento' },
          { progress: 70, text: 'Executando fine-tuning...', details: 'Treinando modelo com seus dados' },
          { progress: 90, text: 'Salvando modelo...', details: 'Finalizando processo' }
        ];
        
        // Executar etapas
        for (let i = 0; i < steps.length; i++) {
          const step = steps[i];
          updateProgress(step.progress, step.text, step.details);
          await new Promise(resolve => setTimeout(resolve, 2000)); // Simular tempo de processamento
        }
        
        // Chamar endpoint de fine-tuning
        updateProgress(95, 'Finalizando processo...', 'Conectando com servidor');
        
        const response = await fetch('/api/admin/finetuning/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({})
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Finalizar progresso
          updateProgress(100, 'Fine-tuning concluÃ­do!', 'Modelo treinado com sucesso');
          
          // Parar monitor de desempenho
          clearInterval(performanceInterval);
          
          // Atualizar botÃ£o
          finetuningBtn.innerHTML = 'âœ… Fine-tuning ConcluÃ­do';
          finetuningBtn.style.background = '#1a4d2a';
          finetuningBtn.style.color = '#5db88f';
          finetuningBtn.disabled = false;
          
          // Atualizar conteÃºdo
          document.getElementById('adminContent').innerHTML = `
            <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
              <h4 style="color: #5db88f; margin-bottom: 15px;">âœ… Fine-tuning ConcluÃ­do com Sucesso!</h4>
              <div style="background: #1a4d2a; padding: 15px; border-radius: 4px; margin-bottom: 15px; border: 1px solid #5db88f;">
                <div style="color: #5db88f; font-weight: bold; margin-bottom: 10px;">ğŸ“Š EstatÃ­sticas do Treinamento:</div>
                <div style="color: #7a9ca8; font-size: 12px;">
                  â€¢ Conversas utilizadas: ${result.stats?.conversations || 'N/A'}<br>
                  â€¢ Mensagens processadas: ${result.stats?.messages || 'N/A'}<br>
                  â€¢ Documentos processados: ${result.stats?.documentQA || 'N/A'}<br>
                  â€¢ Feedback mÃ©dio: ${result.stats?.avgFeedback || 'N/A'}/5.0<br>
                  â€¢ Modelo base: ${result.model || 'qwen2.5:14b'}
                </div>
              </div>
              <p style="color: #5db88f; font-size: 12px;">
                ğŸ‰ O modelo foi treinado com sucesso! Agora ele pode responder perguntas baseadas nos seus documentos.
              </p>
            </div>
          `;
          
          // Atualizar status de fine-tuning
          setTimeout(() => {
            updateFineTuningStatus();
          }, 2000);
          
        } else {
          throw new Error(result.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error('Erro no fine-tuning:', error);
        
        // Parar monitor de desempenho se estiver rodando
        if (typeof performanceInterval !== 'undefined') {
          clearInterval(performanceInterval);
        }
        
        // Ocultar elementos de progresso
        document.getElementById('finetuningProgress').style.display = 'none';
        document.getElementById('performanceMonitor').style.display = 'none';
        
        // Restaurar botÃ£o
        finetuningBtn.innerHTML = originalText;
        finetuningBtn.disabled = false;
        finetuningBtn.style.background = '#4d1a1a';
        finetuningBtn.style.color = '#ff6b6b';
        
        document.getElementById('adminContent').innerHTML = `
          <div style="background: #0f1419; padding: 20px; border-radius: 6px; border: 1px solid #2d6a7a;">
            <h4 style="color: #ff6b6b; margin-bottom: 15px;">âŒ Erro no Fine-tuning</h4>
            <p style="color: #ff6b6b;">${error.message}</p>
            <p style="color: #7a9ca8; font-size: 12px; margin-top: 10px;">
              Verifique se hÃ¡ dados suficientes e tente novamente.
            </p>
          </div>
        `;
      }
    }

    // Carregar ao iniciar
    loadConvs();
  </script>
</body>
</html>

